# Block direct pushes to main unless explicitly allowed
# Use: ALLOW_MAIN_PUSH=1 git push  (to bypass this check)

current_branch=$(git rev-parse --abbrev-ref HEAD)

if [ "$current_branch" = "main" ] && [ "$ALLOW_MAIN_PUSH" != "1" ]; then
  echo ""
  echo "â›” Direct push to main is blocked."
  echo ""
  echo "Please create a pull request instead:"
  echo "  1. Create a branch: devflow branch"
  echo "  2. Make your changes and commit: devflow commit"
  echo "  3. Create a PR: devflow pr"
  echo ""
  echo "To bypass this check (not recommended):"
  echo "  ALLOW_MAIN_PUSH=1 git push"
  echo ""
  exit 1
fi

npm test
npx tsc --noEmit
